meta {
  name: Firebase Converter function bad image
  type: http
  seq: 7
}

post {
  url: {{api_url}}?target=converter
  body: json
  auth: none
}

params:query {
  target: converter
}

body:json {
  {
    "files": [
      {
        "dataUrl": "data:image/png;base64,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",
        "name": "edt-test.png",
        "type": "image/png"
      }
    ],
    "timeZone": "Europe/Paris",
    "currentDate": "2025-10-06"
  }
}

tests {
  test("Status code is 200", function() {
    expect(res.getStatus()).to.equal(200);
  });
  
  test("Response is valid JSON", function() {
    expect(res.getBody()).to.be.an("object");
  });
  
  test("Response has section field", function() {
    expect(res.getBody()).to.have.property("message");
    expect(res.getBody()).to.have.property("error");
    expect(res.getBody()).to.have.property("success");
  });
  
  test("success false", function() {
    const body = res.getBody();
    expect(body.success).to.equal(false);
    expect(body.message).to.equal("Generated ICS content is invalid");
  });
  
}

settings {
  encodeUrl: true
}

docs {
  # Firebase Converter Function Test
  
  This request tests a Firebase function endpoint that converts data and returns it in iCalendar format.
  
  ## Expected Response
  
  The API should return a JSON object containing the following fields:
  - `icsContent`: A string containing the iCalendar data, starting with `BEGIN:VCALENDAR` and ending with `END:VCALENDAR`.
  - `success`: A boolean indicating whether the conversion was successful.
  - `error`: (optional) A string containing an error message if the conversion failed.
  
  ## Tests Performed
  
  1. Verify HTTP status code is 200
  2. Verify response is valid JSON
  3. Verify response contains the fields: `icsContent` and `success`
  4. Verify `icsContent` starts with `BEGIN:VCALENDAR` and ends with `END:VCALENDAR`
}
