<app-card id="converter" title="üìÖ Calendar Converter App">
  <!-- Auth Required Message (when not authenticated) -->
  @if (!isAuthLoading && !isAuthenticated) {
    <section class="auth-required" aria-labelledby="auth-heading">
      <div class="auth-message">
        <h3 id="auth-heading" class="sr-only">Authentication Required</h3>
        <p>
          Upload or snap your appointments, and AI turns them into calendar-ready events.
        </p>
        <img src="/assets/images/converter.png" class="auth-image" />
      </div>
      <button class="sign-in-button" (click)="signIn()" aria-label="Sign in with Google to use converter">
        üîê Sign in with Google
      </button>
    </section>
  }

  <!-- Loading State -->
  @if (isAuthLoading) {
    <div class="auth-loading" role="status" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
      <p>Loading...</p>
    </div>
  }

  <!-- Converter UI (only shown when authenticated) -->
  @if (!isAuthLoading && isAuthenticated) {
    <!-- Upload Area - Only show if no events extracted -->
    @if (extractedEvents().length === 0) {
      <section class="upload-zone"
        [class.dragging]="isDragging()"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
        role="region"
        aria-labelledby="upload-heading"
      >
        <div class="upload-icon" aria-hidden="true">üì§</div>
        <h3 id="upload-heading" class="sr-only">Upload Files</h3>
        <p>Drop files here or</p>
        <label class="upload-button">
          <input
            type="file"
            class="file-input"
            multiple
            accept="image/jpeg,image/jpg,image/png,application/pdf"
            (change)="onFileSelect($event)"
            [disabled]="isProcessing()"
            aria-label="Select files to upload"
          />
          <span>Browse</span>
        </label>
      </section>

      <!-- Selected Files - Minimalist -->
      @if (files().length > 0) {
        <div class="selected-files" role="list" aria-label="Selected files">
          @for (file of files(); track $index) {
            <div class="file-chip" role="listitem">
              <span>{{ file.name }}</span>
              <button
                class="chip-remove"
                (click)="removeFile($index)"
                [disabled]="isProcessing()"
                [attr.aria-label]="'Remove ' + file.name"
              >
                ‚úï
              </button>
            </div>
          }
        </div>
      }

      <!-- Convert Button -->
      @if (files().length > 0 && !isProcessing()) {
        <button class="action-button" (click)="convertToIcs()" aria-label="Convert files to calendar events">
          Convert
        </button>
      }

      @if (isProcessing()) {
        <div class="processing" role="status" aria-live="polite">
          <span class="spinner" aria-hidden="true"></span>
          <span>Processing...</span>
        </div>
      }
    }

    <!-- Error Message -->
    @if (errorMessage()) {
      <div class="alert error" role="alert" aria-live="assertive">
        {{ errorMessage() }}
      </div>
    }

    <!-- Extracted Events - Apple Calendar Style -->
    @if (extractedEvents().length > 0) {
      <section class="events-list" aria-labelledby="events-heading">
        <h3 id="events-heading" class="sr-only">Extracted Calendar Events</h3>
        @for (event of extractedEvents(); track $index) {
          <article class="event-item link" [attr.aria-label]="'Event: ' + event.summary">
            <div class="event-date" aria-hidden="true">
              <div class="date-block">
                <span [innerHTML]="getMonthDay(event.start)"></span>
              </div>
            </div>
            <div class="event-details">
              <div class="event-content">
                <h4 class="event-title">{{ event.summary }}</h4>
                <div class="event-location">
                  @if (event.location) {
                    <span aria-label="Location">üìç {{ event.location }}</span>
                  }
                </div>
              </div>
              <div class="event-times">
                <time class="event-time" [attr.datetime]="event.start">{{ getTime(event.start) }}</time>
                @if (event.end && getTime(event.end)) {
                  <time class="event-time-end" [attr.datetime]="event.end">{{ getTime(event.end) }}</time>
                }
              </div>
            </div>
          </article>
        }
      </section>

      <!-- Download Button -->
      <nav class="actions" aria-label="Calendar actions">
        <button class="action-button download" (click)="downloadIcs()" aria-label="Download calendar file">
          Download Calendar
        </button>
        <button class="action-button secondary" (click)="resetState()" aria-label="Convert another file">
          Convert Another
        </button>
      </nav>
    }
  }
</app-card>
