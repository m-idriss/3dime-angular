<!-- Toast Container for Global Messages -->
<div class="toast-container position-fixed top-0 start-50 translate-middle-x p-3" style="z-index: 12000">
  <!-- Success Toast -->
  @if (toastService.successMessage()) {
  <ngb-toast [autohide]="true" [delay]="5000" (hidden)="toastService.clearSuccess()" class="bg-success text-white">
    {{ toastService.successMessage() }}
  </ngb-toast>
  }

  <!-- Error Toast -->
  @if (toastService.errorMessage()) {
  <ngb-toast [autohide]="true" [delay]="5000" (hidden)="toastService.clearError()" class="bg-danger text-white">
    {{ toastService.errorMessage() }}
  </ngb-toast>
  }
</div>

<main class="home-page" aria-label="Main content" id="main-content" role="main">
  <div class="home-container">
    <article class="hero-section" itemscope itemtype="https://schema.org/WebApplication">
      <h1 class="hero-title" itemprop="name">
        <span class="hero-icon" aria-hidden="true">ðŸ“…</span>
        Your Automated Calendar Converter
      </h1>
      <p class="hero-description" itemprop="description">
        Upload images of your appointments, and AI turns them into calendar-ready events.<br />
        No separate signup â€” sign in with Google. 3 free conversions/month, contact us to upgrade for higher limits.
      </p>

      <!-- Key Features for SEO -->
      <div class="hero-features" style="display: none" itemprop="featureList">
        <ul>
          <li>Convert images (JPG, PNG) and PDF files to calendar events</li>
          <li>AI-powered event extraction with GPT-4 Vision</li>
          <li>Batch processing - upload multiple files at once</li>
          <li>Edit events before downloading</li>
          <li>Export to ICS format (Google Calendar, Outlook, Apple Calendar compatible)</li>
          <li>3 free conversions per month - contact us to upgrade for higher limits</li>
          <li>Secure and privacy-focused processing</li>
        </ul>
      </div>
    </article>

    <!-- Desktop: Side-by-side layout when events exist, centered when no events -->
    <div class="content-layout" [class.has-calendar]="calendarStateService.isVisible() && isDesktop()">
      <div class="converter-card">
        <app-converter></app-converter>
      </div>

      <!-- Desktop inline calendar view (only when visible and desktop) -->
      @if (calendarStateService.isVisible() && isDesktop()) {
      <div class="calendar-card">
        <app-calendar-view [events]="calendarStateService.events()" [visible]="calendarStateService.isVisible()"
          [inline]="true" (visibleChange)="handleCalendarVisibilityChange($event)"
          (eventsChange)="handleCalendarEventsChange($event)" (exportIcs)="handleCalendarExport()" />
      </div>
      }
    </div>

    <!-- Quota Status Bar - Outside converter container -->
    @if (converterReady() && converterComponent) {
    @let quotaLimitVal = converterComponent.quotaLimit();
    @let quotaRemainingVal = converterComponent.quotaRemaining();
    @let planTypeVal = (converterComponent.planType() ?? '').toUpperCase();
    @if (
    !converterComponent.isQuotaLoading() &&
    converterComponent.quotaEnabled() &&
    quotaLimitVal !== null &&
    quotaRemainingVal !== null &&
    quotaLimitVal > 0
    ) {
    <div class="quota-status-bar" role="status" aria-live="polite">
      <div class="d-flex flex-column gap-1">
        <ngb-progressbar [value]="100 - (quotaRemainingVal / quotaLimitVal) * 100" [type]="
                quotaRemainingVal >= quotaLimitVal / 2
                  ? 'success'
                  : quotaRemainingVal >= quotaLimitVal / 3
                    ? 'warning'
                    : 'danger'
              " [showValue]="true" [striped]="true" [animated]="true" height="20px"
          ngbTooltip="{{ quotaLimitVal - quotaRemainingVal }} / {{ quotaLimitVal }} used this month. [{{ planTypeVal }} account]"></ngb-progressbar>

        <!-- Inline text showing subscription and quota remaining -->
        @if (quotaRemainingVal > 0) {
        <div class="quota-info mt-1 text-nowrap small text-muted align-self-center" role="note" aria-live="polite">
          <span class="fw-semibold">Plan:</span>
          <span class="ms-1">{{ planTypeVal || 'FREE' }}</span>
          <span class="mx-2">â€¢</span>
          <span class="fw-semibold">Usage:</span>
          <span class="ms-1">{{ quotaLimitVal - quotaRemainingVal }} / {{ quotaLimitVal }}</span>
          <span class="mx-2">â€¢</span>
          <span>{{ quotaRemainingVal }} left this month</span>
          <span class="visually-hidden">{{ quotaRemainingVal }} remaining out of {{ quotaLimitVal }} total</span>
        </div>
        }
      </div>
    </div>
    }
    }

    <!-- How It Works Section -->
    <section class="how-it-works-section" aria-labelledby="how-it-works-title">
      <h2 id="how-it-works-title" class="section-title">How It Works</h2>
      <div class="steps-container">
        <div class="step-item">
          <div class="step-badge">1</div>
          <div class="step-content">
            <h3 class="step-title">Snap or upload your schedule</h3>
            <p class="step-description">Take a photo or upload an image of your appointments</p>
          </div>
        </div>

        <div class="step-item">
          <div class="step-badge">2</div>
          <div class="step-content">
            <h3 class="step-title">AI reads your appointments</h3>
            <p class="step-description">Our AI extracts all event details automatically</p>
          </div>
        </div>

        <div class="step-item">
          <div class="step-badge">3</div>
          <div class="step-content">
            <h3 class="step-title">Export directly to your calendar</h3>
            <p class="step-description">Download and import to Google Calendar, Outlook, or Apple Calendar</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Why PhotoCalia Section -->
    <section class="why-photocalia-section" aria-labelledby="why-photocalia-title">
      <h2 id="why-photocalia-title" class="section-title">Why PhotoCalia</h2>
      <div class="benefits-container">
        <div class="benefit-item">
          <div class="benefit-check">âœ“</div>
          <div class="benefit-content">
            <h3 class="benefit-title">Multiple Formats</h3>
            <p class="benefit-description">Converts JPG, PNG & PDF files</p>
          </div>
        </div>

        <div class="benefit-item">
          <div class="benefit-check">âœ“</div>
          <div class="benefit-content">
            <h3 class="benefit-title">Batch Processing</h3>
            <p class="benefit-description">Upload multiple files at once</p>
          </div>
        </div>

        <div class="benefit-item">
          <div class="benefit-check">âœ“</div>
          <div class="benefit-content">
            <h3 class="benefit-title">Full Control</h3>
            <p class="benefit-description">Edit events before exporting</p>
          </div>
        </div>

        <div class="benefit-item">
          <div class="benefit-check">âœ“</div>
          <div class="benefit-content">
            <h3 class="benefit-title">Free Tier Available</h3>
            <p class="benefit-description">3 free conversions/month, contact us for higher limits</p>
          </div>
        </div>

        <div class="benefit-item">
          <div class="benefit-check">âœ“</div>
          <div class="benefit-content">
            <h3 class="benefit-title">Privacy First</h3>
            <p class="benefit-description">Secure & privacy-focused</p>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>

<!-- Single calendar instance with responsive inline mode -->
@if (calendarStateService.isVisible() && !isDesktop()) {
<app-calendar-view [events]="calendarStateService.events()" [visible]="calendarStateService.isVisible()"
  [inline]="false" (visibleChange)="handleCalendarVisibilityChange($event)"
  (eventsChange)="handleCalendarEventsChange($event)" (exportIcs)="handleCalendarExport()" />
}
